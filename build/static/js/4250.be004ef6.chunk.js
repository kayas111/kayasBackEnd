"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[4250],{54250:(e,t,a)=>{a.r(t),a.d(t,{CreateArticle:()=>u,default:()=>h});var i=a(56024),s=a(98289),n=a(59978),r=a(35407),l=a(65043),o=(a(47890),a(77977)),c=a(80726),d=a.n(c),m=a(70579);s.A.initializeApp({apiKey:"AIzaSyCf0LC-eL1pJ2Rpvh59ukbg5OUFm6IcrEA",authDomain:"kayas-42321.firebaseapp.com",projectId:"kayas-42321",storageBucket:"kayas-42321.appspot.com"});const p=s.A.storage().ref();function u(){const[e,t,a]=(0,r.lT)(["user"]),[s,c]=(0,l.useState)(""),[u,h]=(0,l.useState)(""),[g,y]=(0,l.useState)(0),[f,b]=(0,l.useState)("Image appears here");async function x(){c("Initializing........."),setTimeout(()=>{c("Gathering requirements................."),setTimeout(()=>{c("Creating...........................")},5e3)},5e3);let t=await fetch("/getTradingDetails/".concat(parseInt(e.user.contact))).then(e=>e.json()).then(e=>e[0]);if(t.permissionTokensObj.createPubArticleTokens<1||t.permissionTokensObj.createPubArticleTokens>1){let e={headline1:document.getElementById("articleCreateForm")[0].value.trim(),institution:t.institution.trim(),author:t.name.trim(),contact:parseInt(t.contact),body:u.trim()},a=await fetch("/createArticle",{method:"post",headers:{"Content-type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>e);if(1===a.limitReached)(0,i.yd)("toastAlert2","Maximum number of articles reached. Delete some",5e3);else{let e=await document.querySelector("#pubArticleImageInputElement").files[0];if(document.getElementById("articleCreateForm").articleHeadline1.value="",void 0===e)window.location.href="/pages/pubarticles/article/".concat(a.id),c("Finalizing.......");else{c("Uploading image..........");let t=0;setInterval(()=>{94!==t&&(t+=1,y(t))},450);let s="pubArticleImage_".concat(a.id),n=p.child("pubArticleImages/".concat(s));await n.put(e).then(async e=>{c("Getting image URL ..........");let t=await n.getDownloadURL({orderBy:"generation",limitTo:1}).then(e=>e);fetch("/addPubArticleImageUrlToArticle",{method:"post",headers:{"Content-type":"application/json"},body:JSON.stringify({contact:parseInt(a.contact),articleId:a.id,imageDownLoadUrl:t})}).then(e=>{c("Image saved"),window.location.href="/pages/pubarticles/article/".concat(a.id),(0,i.yd)("toastAlert1","Finalizing......",5e3)})})}}}else 0===t.permissionTokensObj.createPubArticleTokens?(0,i.yd)("toastAlert2","Maximum number of articles reached. Delete some",4e3):(0,i.yd)("toastAlert2","Error, try again",3e3)}return(0,l.useEffect)(()=>{(0,i.Qb)(e)},[]),(0,m.jsx)("div",{style:{padding:"3px"},children:(0,m.jsxs)("div",{className:"row",children:[(0,m.jsx)("div",{class:"col-md-3"}),(0,m.jsxs)("div",{class:"col-md-6",children:[(0,m.jsx)("div",{class:"pageLabel",children:"Create an article"}),(0,m.jsx)("div",{class:"pageDescription",children:"Create information that people can read online. Attach a photo where necessary"}),(0,m.jsx)("div",{style:{paddingBottom:"5px",paddingTop:"10px"},children:(0,m.jsx)(n.dV,{})}),(0,m.jsxs)("form",{method:"post",id:"articleCreateForm",action:"#",children:[(0,m.jsxs)("div",{class:"mb-3",children:[(0,m.jsx)("div",{class:"formInputLabel",children:"Type headline"}),(0,m.jsx)("textarea",{rows:"3",type:"text",class:"form-control",autoComplete:"off",name:"articleHeadline1"}),(0,m.jsx)("br",{}),(0,m.jsxs)("div",{class:"formInputLabel",children:["Add photo ",(0,m.jsxs)("span",{style:{fontSize:"12px"},children:[" ",(0,m.jsx)("input",{type:"file",id:"pubArticleImageInputElement",name:"file",onChange:e=>{let t=document.querySelector("#pubArticleImageInputElement").files[0],a=Array.from(t.type);"i"===a[0]&&"m"===a[1]&&"a"===a[2]&&"g"===a[3]&&"e"===a[4]?b(URL.createObjectURL(t)):((0,i.yd)("toastAlert2","Image format ".concat(t.type," not supported. Change image"),5e3),setTimeout(()=>{window.location.href="/pages/pubarticles/createarticle"},5e3))}})]})]}),(0,m.jsx)("div",{style:{paddingTop:"4px"},children:(0,m.jsx)("img",{src:f,class:" d-block w-100",alt:""})}),(0,m.jsx)("br",{}),(0,m.jsx)("div",{class:"formInputLabel",children:"Type/Paste your message here:"}),(0,m.jsx)(o.CKEditor,{config:{toolbar:["Bold","Italic","Link","NumberedList","BulletedList"]},editor:d(),onChange:(e,t)=>{const a=t.getData();h(a)}})]}),(0,m.jsx)("div",{class:"status",children:s}),(0,m.jsx)("progress",{value:g,max:"100",style:{width:"100%"}}),(0,m.jsx)("div",{onClick:()=>{if(Array.from(document.getElementById("articleCreateForm").articleHeadline1.value.trim()).length<1)(0,i.yd)("toastAlert2","Enter a headline",3e3);else if(Array.from(u).length<1){void 0===document.querySelector("#pubArticleImageInputElement").files[0]?(0,i.yd)("toastAlert2","Type or paste some information in the body section",3e3):x()}else x()},class:"btn btn-success",style:{width:"100%"},children:"Create Article"}),(0,m.jsx)("p",{})]})]}),(0,m.jsx)("div",{class:"col-md-3"})]})})}const h=u}}]);
//# sourceMappingURL=4250.be004ef6.chunk.js.map